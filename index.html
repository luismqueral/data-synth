<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataSynth</title>
    
    <!-- Tachyons CSS -->
    <link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,600;1,400;1,600&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- D3.js for visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Preload critical modules for faster startup -->
    <link rel="modulepreload" href="./lib/data-processor.js">
    <link rel="modulepreload" href="./lib/audio-engine.js">
    <link rel="modulepreload" href="./lib/parameter-mapper.js">
    <link rel="modulepreload" href="./lib/patch-viz.js">
    
    <style>
        /* Lucida Blackletter Font */
        @font-face {
            font-family: 'Lucida Blackletter';
            src: url('fonts/LucidaBlackletter.woff2') format('woff2'),
                 url('fonts/LucidaBlackletter.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        
        * {
            font-family: 'IBM Plex Sans', sans-serif;
        }
        
        /* Keep monospace for data/code elements */
        .node-text,
        .node-value,
        input[type="text"],
        input[type="number"],
        select,
        code,
        pre {
            font-family: 'IBM Plex Mono', monospace;
        }
        
        /* Tachyons-style utility: IBM Plex Mono font family */
        .ibm-mono { font-family: 'IBM Plex Mono', monospace; }
        .ibm-mono-i { font-family: 'IBM Plex Mono', monospace; font-style: italic; }
        
        /* Hover underline effect */
        .hover-underline:hover {
            text-decoration: underline !important;
        }
        
        /* Play random dataset link press effect */
        #playRandomDatasetLink:active {
            transform: translateY(1px);
        }
        
        /* Randomize mappings header area states */
        #randomizeMappingsBtnHeader[style*="opacity: 1"] {
            opacity: 1 !important;
            pointer-events: auto !important;
        }
        
        #randomizeMappingsBtnHeader[style*="opacity: 1"]:hover {
            background: #f5f5f5 !important;
        }
        
        #randomizeMappingsBtnHeader[style*="opacity: 1"]:hover .randomize-text {
            color: #000 !important;
        }
        
        #randomizeMappingsBtnHeader[style*="opacity: 1"]:active {
            transform: translateY(1px) !important;
        }
        
        /* Custom tooltip styling */
        .tooltip-container {
            position: relative;
            display: inline-flex;
            align-items: center;
        }
        
        .tooltip-icon {
            cursor: help;
            transition: opacity 0.2s;
        }
        
        .tooltip-icon:hover {
            opacity: 0.7;
        }
        
        .tooltip-text {
            visibility: hidden;
            opacity: 0;
            width: 240px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 8px 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            line-height: 1.4;
            font-weight: normal;
            transition: opacity 0.2s, visibility 0.2s;
            pointer-events: none;
        }
        
        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Play visualizer button states */
        #playDataBtn {
            transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
        }
        
        #playDataBtn.disabled {
            opacity: 0.5;
            pointer-events: none;
            cursor: not-allowed;
        }
        
        #playDataBtn:not(.disabled):hover {
            transform: translateY(2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        #playDataBtn:not(.disabled):hover canvas {
            border-color: #999;
        }
        
        #playDataBtn:not(.disabled):hover #playOverlay > div {
            background: rgba(0,0,0,0.85);
            transform: scale(1.1);
        }
        
        #playDataBtn:not(.disabled):active {
            transform: translateY(3px);
        }
        
        #playOverlay {
            opacity: 1;
            transition: opacity 0.2s ease;
        }
        
        /* Hide overlay during playback, show on hover */
        #playDataBtn.playing #playOverlay {
            opacity: 0;
        }
        
        #playDataBtn.playing:hover #playOverlay {
            opacity: 1;
        }
        
        #playOverlay > div {
            transition: all 0.2s ease;
        }
        
        canvas {
            transition: border-color 0.15s ease;
        }
        
        
        body {
            margin: 0;
            padding: 0;
            background: #fff;
        }
        
        .section {
            margin-bottom: 40px;
            padding-bottom: 40px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .section:last-of-type {
            border-bottom: none;
        }
        
        .section-header {
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #000;
        }
        
        /* Settings Panel - Slide-out from left */
        .settings-trigger {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: transparent;
            color: #000;
            border: none;
            padding: 10px 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease-in-out;
            border-radius: 3px;
        }
        
        .settings-trigger:hover {
            background: #f5f5f5;
        }
        
        .settings-trigger.shifted {
            position: fixed;
            left: 20px;
            top: 20px;
            background: #fafafa;
            border: none;
            border-radius: 3px;
            width: auto;
            justify-content: flex-start;
            z-index: 1002;
        }
        
        /* Subtle blur fade at top of panel when open */
        .settings-panel-fade {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: linear-gradient(to bottom, 
                rgba(250, 250, 250, 0.7) 0%, 
                rgba(250, 250, 250, 0.5) 40%,
                rgba(250, 250, 250, 0.2) 70%,
                rgba(250, 250, 250, 0) 100%);
            backdrop-filter: blur(2px);
            -webkit-backdrop-filter: blur(2px);
            pointer-events: none;
            z-index: 1000;
        }
        
        .settings-trigger.shifted:hover {
            background: #f0f0f0;
        }
        
        /* Icon and text crossfade animation */
        .settings-icon,
        .close-icon {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            flex-shrink: 0;
        }
        
        .settings-text {
            transition: opacity 0.3s ease-in-out;
            white-space: nowrap;
        }
        
        .settings-icon {
            opacity: 1;
            transform: rotate(0deg);
        }
        
        .close-icon {
            opacity: 0;
            transform: rotate(-90deg);
            position: absolute;
            left: 10px;
        }
        
        .settings-trigger.shifted .settings-icon {
            opacity: 0;
            transform: rotate(90deg);
        }
        
        .settings-trigger.shifted .close-icon {
            opacity: 1;
            transform: rotate(0deg);
        }
        
        /* Keep Settings text visible when open */
        
        .settings-panel {
            position: fixed;
            top: 0;
            left: -320px;
            width: 320px;
            height: 100vh;
            background: #fafafa;
            z-index: 999;
            transition: left 0.3s ease-in-out;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .settings-panel.open {
            left: 0;
        }
        
        /* Main content shifts right when panel opens */
        body {
            transition: margin-left 0.3s ease-in-out;
            margin-left: 0;
        }
        
        body.shifted {
            margin-left: 320px;
        }
        
        .settings-panel-content {
            padding: 20px;
            padding-top: 90px;
            flex: 1;
            overflow-y: auto;
        }
        
        /* Hide scrollbar but keep functionality */
        .settings-panel-content::-webkit-scrollbar {
            display: none;
        }
        
        .settings-panel-content {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Visual waveform selector styling */
        .waveform-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            margin-bottom: 4px;
            border: 1px solid transparent;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .waveform-option:hover {
            background: #f0f0f0;
            border-color: #ddd;
        }
        
        .waveform-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }
        
        .waveform-option input[type="radio"]:checked + .waveform-visual {
            opacity: 1;
        }
        
        .waveform-option input[type="radio"]:checked ~ span {
            font-weight: 600;
            color: #000;
        }
        
        .waveform-option:has(input[type="radio"]:checked) {
            background: #f0f0f0;
            border-color: #000;
        }
        
        .waveform-visual {
            width: 40px;
            height: 20px;
            opacity: 0.3;
            transition: opacity 0.2s;
            flex-shrink: 0;
        }
        
        .waveform-option span {
            color: #666;
            transition: all 0.2s;
        }
        
        .settings-backdrop {
            display: none;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .content-wrapper {
                padding: 12px !important;
                max-width: 100% !important;
            }
            
            h1 {
                font-size: 2rem !important;
            }
            
            #playDataBtn {
                min-width: 140px !important;
                padding: 12px 16px !important;
                font-size: 18px !important;
            }
            
            #patchViz {
                overflow-x: auto;
            }
            
            /* Settings panel - full width on mobile */
            .settings-panel {
                width: 100%;
                max-width: 100vw;
                left: -100%;
            }
            
            .settings-panel.open {
                left: 0;
            }
            
            .settings-trigger {
                top: 12px;
                left: 12px;
                width: 36px;
                height: 36px;
                padding: 8px;
            }
            
            .settings-trigger.shifted {
                left: calc(100% - 48px);
            }
            
            .settings-icon,
            .close-icon {
                font-size: 16px;
            }
            
            /* Don't shift body on mobile - panel is full width overlay */
            body.shifted {
                margin-left: 0;
            }
        }
        
        /* ================================================================
           AUDIO VISUALIZER STYLES (Oscilloscope)
           Required by: lib/audio-engine.js
           ================================================================ */
        
        #audioVisualizerContainer {
            /* Minimal container - no border, no background */
        }
        
        #audioVisualizer {
            background: #fff;
            border: 1px solid #ddd;
            display: block;
        }
        
        /* ================================================================
           PATCH VISUALIZATION STYLES
           Required by: lib/patch-viz.js
           ================================================================ */
        
        .node-rect {
            fill: #f5f5f5;
            stroke: none;
            cursor: default;
        }
        
        .node.unmapped {
            opacity: 0.4;
        }
        
        .node.hover-dimmed {
            opacity: 0.2;
            transition: opacity 0.2s;
        }
        
        .node {
            transition: opacity 0.2s;
        }
        
        .connection-path.hover-dimmed {
            stroke: #efefef !important;
            transition: stroke 0.2s;
        }
        
        .connection-path-yellow.hover-dimmed {
            stroke: #efefef !important;
            transition: stroke 0.2s;
        }
        
        .connection-path,
        .connection-path-yellow {
            transition: stroke 0.2s;
        }
        
        .param-bar-fill {
            transition: width 0.15s ease-out;
        }
        
        .node-text {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            pointer-events: none;
            text-anchor: middle;
            font-weight: 400;
        }
        
        .node-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            fill: #666;
            font-weight: 400;
            pointer-events: none;
            text-anchor: middle;
        }
        
        .node-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            fill: #666;
            font-weight: 400;
            pointer-events: none;
            text-anchor: middle;
        }
        
        .port {
            fill: #fff;
            stroke: #000;
            stroke-width: 2;
            cursor: default;
        }
        
        /* Connection lines: Always show yellow/black dashed pattern */
        .connection-path-yellow {
            stroke: #FFD700;
            stroke-width: 3;
            fill: none;
            pointer-events: none;
            stroke-dasharray: 8, 8;
        }
        
        .connection-path {
            stroke: #000;
            stroke-width: 3;
            fill: none;
            cursor: pointer;
            stroke-dasharray: 8, 8;
            stroke-dashoffset: 8;
        }
        
        .connection-path:hover {
            stroke: #000;
            stroke-width: 4;
        }
        
        .connection-path:hover + .connection-path-yellow,
        .connection-path-yellow.hover {
            stroke-width: 4;
        }
        
        .playback-labels {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 10px;
            color: #666;
            min-width: 80px;
            text-align: center;
        }
        
        .playback-value {
            font-size: 14px;
            color: #000;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Settings Trigger Button -->
    <button id="settingsTriggerBtn" class="settings-trigger" title="Settings">
        <div style="display: flex; align-items: center; gap: 8px;">
            <!-- Tune icon (settings) - Material Icons -->
            <svg class="settings-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
            </svg>
            <!-- Close icon - Material Icons -->
            <svg class="close-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
            <!-- Settings text -->
            <span class="settings-text b f6">Settings</span>
        </div>
    </button>
    
    <!-- Settings Backdrop -->
    <div id="settingsBackdrop" class="settings-backdrop"></div>
    
    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel" style="visibility: hidden;">
        <!-- Gradient fade overlay (only visible when panel open) -->
        <div class="settings-panel-fade"></div>
        
        <div class="settings-panel-content" id="settingsPanelContent">
            <!-- All settings controls -->
            <div class="mb3" style="padding-bottom: 12px; border-bottom: 2px solid #ddd;">
                <div class="b mb2 f6">Volume</div>
                <label class="db mb2">
                    <span class="db mb1 f6">Master Volume:</span>
                    <input type="range" id="masterVolume" min="0" max="1" step="0.01" value="0.2" class="w-100">
                    <span id="masterVolumeValue" class="f6">0.2 (20%)</span>
                </label>
                <label class="db mb2">
                    <span class="db mb1 f6">Master Pitch:</span>
                    <input type="range" id="pitchControl" min="-24" max="24" step="0.1" value="0" class="w-100">
                    <span id="pitchValue" class="f6">0 semitones</span>
                </label>
                <label class="db mb2">
                    <span class="db mb1 f6">Speed:</span>
                    <input type="range" id="speedControl" min="0.1" max="5" step="0.1" value="1" class="w-100">
                    <span id="speedValue" class="f6">1x</span>
                </label>
            </div>
            
            <div class="mb3" style="padding-bottom: 12px; border-bottom: 2px solid #ddd;">
                <div class="b mb2 f6">Sound Source</div>
                <label class="db mb2 f6">
                    <input type="radio" name="soundSource" value="synthesizer" checked class="mr2" id="synthesizerMode">
                    <span>üéπ Synthesizer (Oscillators)</span>
                </label>
                <label class="db mb2 f6">
                    <input type="radio" name="soundSource" value="sampler" class="mr2" id="samplerMode">
                    <span>üéµ Sampler (Audio Files)</span>
                </label>
                
                <!-- Sample Upload Section (hidden by default) -->
                <div id="sampleUploadSection" style="display: none; margin-top: 12px; padding: 12px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px;">
                    <div class="mb2">
                        <label class="db mb1 f7 b">Load Audio Sample:</label>
                        <input type="file" id="sampleFileInput" accept="audio/wav,audio/mpeg,audio/mp3,audio/ogg,audio/webm,audio/x-m4a,audio/mp4,.wav,.mp3,.ogg,.webm,.m4a" class="f6 w-100" style="padding: 4px;">
                        <div class="f7 mt1" style="color: #666;">Best: WAV, MP3, OGG | M4A may need conversion</div>
                    </div>
                    
                    <!-- Sample Info Display -->
                    <div id="sampleInfo" style="display: none; margin-top: 8px; padding: 8px; background: white; border: 1px solid #ccc; border-radius: 3px;">
                        <div class="f7 mb1">
                            <span class="b">üìÑ File:</span> <span id="sampleFileName">--</span>
                        </div>
                        <div class="f7 mb1">
                            <span class="b">‚è± Duration:</span> <span id="sampleDuration">--</span>
                        </div>
                        <div class="f7 mb2">
                            <span class="b">üìä Format:</span> <span id="sampleFormat">--</span>
                        </div>
                        
                        <button id="clearSampleBtn" class="mt1 pa1 f7 ba b--black bg-white pointer hover-bg-black hover-white" style="width: 100%;">
                            Clear Sample
                        </button>
                    </div>
                    
                    <div id="sampleLoadError" style="display: none; margin-top: 8px; padding: 8px; background: #ffe6e6; border: 1px solid #cc0000; border-radius: 3px; color: #cc0000; white-space: pre-line;" class="f7">
                    </div>
                </div>
            </div>
            
            <div class="mb3">
                <div class="b mb2 f6">Processing</div>
                <label class="db mb2 f6">
                    <input type="checkbox" id="adaptiveNormalization" checked class="mr2">
                    <span>Adaptive Normalization</span>
                </label>
                <div class="f7 ml4 mb2" style="color: #666; line-height: 1.3; margin-top: -6px;">
                    Automatically balances data ranges for more consistent sound levels
                </div>
                <label class="db mb2 f6">
                    <input type="checkbox" id="rhythmicQuantization" class="mr2">
                    <span>Rhythmic Quantization</span>
                </label>
                <div class="f7 ml4 mb2" style="color: #666; line-height: 1.3; margin-top: -6px;">
                    Snaps note timings to a grid for tighter rhythms
                </div>
                <label class="db mb2 f6">
                    <input type="checkbox" id="pitchQuantization" checked class="mr2">
                    <span>Pitch Quantization (Scale)</span>
                </label>
                <div class="f7 ml4 mb2" style="color: #666; line-height: 1.3; margin-top: -6px;">
                    Constrains pitches to selected musical scale
                </div>
            </div>
            
            <div class="mb3" id="scaleContainer" style="display: none;">
                <div class="b mb2 f6">Scale</div>
                <select id="scaleSelector" class="w-100 pa1 ba b--black f6">
                    <option value="pentatonic" selected>Pentatonic (5 notes)</option>
                    <option value="major">Major Scale</option>
                    <option value="minor">Natural Minor</option>
                    <option value="dorian">Dorian Mode</option>
                    <option value="mixolydian">Mixolydian Mode</option>
                    <option value="chromatic">Chromatic (12 notes)</option>
                </select>
            </div>
            
            <div class="mb3" id="waveformSection">
                <div class="b mb2 f6">Waveform</div>
                <div>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="sine" checked>
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M 0,10 Q 5,0 10,10 T 20,10 T 30,10 T 40,10" />
                        </svg>
                        <span>Sine</span>
                    </label>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="square">
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M 0,15 L 0,5 L 10,5 L 10,15 L 20,15 L 20,5 L 30,5 L 30,15 L 40,15" />
                        </svg>
                        <span>Square</span>
                    </label>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="sawtooth">
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M 0,15 L 10,5 L 10,15 L 20,5 L 20,15 L 30,5 L 30,15 L 40,5" />
                        </svg>
                        <span>Sawtooth</span>
                    </label>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="triangle">
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M 0,15 L 5,5 L 15,15 L 25,5 L 35,15 L 40,10" />
                        </svg>
                        <span>Triangle</span>
                    </label>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="white-noise">
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M 0,10 L 2,8 L 4,12 L 6,7 L 8,14 L 10,9 L 12,13 L 14,6 L 16,11 L 18,8 L 20,15 L 22,10 L 24,7 L 26,13 L 28,9 L 30,12 L 32,8 L 34,14 L 36,10 L 38,11 L 40,10" />
                        </svg>
                        <span>White Noise</span>
                    </label>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="pink-noise">
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M 0,10 L 3,9 L 6,11 L 9,8 L 12,12 L 15,10 L 18,11 L 21,9 L 24,10 L 27,11 L 30,9 L 33,10 L 36,11 L 40,10" />
                        </svg>
                        <span>Pink Noise</span>
                    </label>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="brown-noise">
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M 0,10 L 4,11 L 8,10 L 12,11 L 16,10 L 20,11 L 24,10 L 28,11 L 32,10 L 36,11 L 40,10" />
                        </svg>
                        <span>Brown Noise</span>
                    </label>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="fm">
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M 0,10 Q 3,5 6,10 Q 9,15 12,10 Q 13,7 14,10 Q 15,13 16,10 Q 19,5 22,10 Q 25,15 28,10 Q 29,7 30,10 Q 31,13 32,10 Q 35,5 38,10 L 40,10" />
                        </svg>
                        <span>FM Synthesis</span>
                    </label>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="additive">
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M 0,10 Q 5,2 10,10 T 20,10 T 30,10 T 40,10" />
                            <path d="M 0,10 Q 2.5,6 5,10 T 10,10 T 15,10 T 20,10 T 25,10 T 30,10 T 35,10 T 40,10" opacity="0.5" />
                        </svg>
                        <span>Additive</span>
                    </label>
                    <label class="waveform-option">
                        <input type="radio" name="waveform" value="pwm">
                        <svg class="waveform-visual" viewBox="0 0 40 20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M 0,15 L 0,5 L 6,5 L 6,15 L 14,15 L 14,5 L 18,5 L 18,15 L 26,15 L 26,5 L 32,5 L 32,15 L 40,15" />
                        </svg>
                        <span>PWM</span>
                    </label>
                </div>
            </div>
            
            <div class="mb3" id="filterSection">
                <div class="b mb2 f6">Filter</div>
                <label class="db mb1 f6">
                    <input type="radio" name="filterType" value="lowpass" checked class="mr1"> Lowpass
                </label>
                <label class="db mb1 f6">
                    <input type="radio" name="filterType" value="highpass" class="mr1"> Highpass
                </label>
                <label class="db mb1 f6">
                    <input type="radio" name="filterType" value="bandpass" class="mr1"> Bandpass
                </label>
                <label class="db mb1 f6">
                    <input type="radio" name="filterType" value="notch" class="mr1"> Notch
                </label>
            </div>
        </div>
    </div>
    
    <div class="pa3 content-wrapper main-content-wrapper">
        <h1 class="f1 mb2 mt4 tc" style="font-family: 'Lucida Blackletter', 'Blackletter686', serif; font-weight: normal;">DataSynth</h1>
        <p class="tc f6 gray mb3" style="max-width: 600px; margin-left: auto; margin-right: auto; font-family: 'IBM Plex Sans', sans-serif;">
            Turn any dataset into sound. <a href="https://github.com/luismqueral/data-synth" target="_blank" class="black underline">Learn More</a>
        </p>
        
        <!-- Audio Visualizer / Play Button -->
        <div class="center mt5 mb4" style="max-width: 900px;">
            <div id="playDataBtn" class="pointer disabled" style="position: relative;">
                <canvas id="audioVisualizer" style="width: 100%; height: 160px; border: 1px solid #ddd; border-radius: 3px 3px 0 0; cursor: pointer; background: #fff;"></canvas>
                <div id="playOverlay" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none;">
                    <div style="width: 60px; height: 60px; border-radius: 50%; background: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center;">
                        <!-- Material Icons: Play Arrow -->
                        <svg id="playIcon" width="32" height="32" viewBox="0 0 24 24" fill="white" style="margin-left: 3px;">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        <!-- Material Icons: Stop -->
                        <svg id="stopIcon" width="28" height="28" viewBox="0 0 24 24" fill="white" style="display: none;">
                            <path d="M6 6h12v12H6z"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- Data Selection -->
            <div class="pa3" style="background: #f5f5f5; border: 1px solid #ddd; border-top: none; border-radius: 0 0 3px 3px; padding-top: 24px;">
                <div class="mb3 flex items-center justify-between" style="max-width: 480px; margin-left: auto; margin-right: auto;">
                    <div class="b f6 black">Source</div>
                    <a href="#" id="playRandomDatasetLink" class="f7 black ibm-mono pointer hover-underline" style="text-decoration: none; transition: transform 0.05s ease;">Play Random Dataset</a>
                </div>
                <div class="mb2 tc">
                    <select id="templateSelector" class="pa2 ba b--black f6" style="width: 480px; max-width: 90%; border-radius: 3px;">
                        <option value="">-- select dataset --</option>
                    
                    <optgroup label="üåç earth stuff">
                        <option value="datasets/earthquakes-week.geojson">earthquakes-week.geojson (1600 events)</option>
                        <option value="datasets/earthquakes-all-month.geojson">earthquakes-all-month.geojson (9000 events)</option>
                        <option value="datasets/earthquakes-major-month.geojson">earthquakes-major-month.geojson (M4.5+)</option>
                        <option value="datasets/earthquakes-significant-month.geojson">earthquakes-significant-month.geojson</option>
                        <option value="datasets/hurricanes-atlantic-2023.json">hurricanes-atlantic-2023.json (20 storms)</option>
                        <option value="datasets/wildfire-california-2020.json">wildfire-california-2020.json (16 fires)</option>
                        <option value="datasets/volcanic-eruptions-recent.json">volcanic-eruptions-recent.json (14 eruptions)</option>
                        <option value="datasets/air-quality-global-cities.json">air-quality-global-cities.json (16 cities)</option>
                        <option value="datasets/ocean-buoy-measurements.json">ocean-buoy-measurements.json (15 buoys)</option>
                    </optgroup>
                    
                    <optgroup label="‚öæ baseball">
                        <option value="datasets/baseball-home-runs-2024.json">baseball-home-runs-2024.json (25 players)</option>
                        <option value="datasets/baseball-world-series-2024.json">baseball-world-series-2024.json (5 games)</option>
                    </optgroup>
                    
                    <optgroup label="üí∞ money">
                        <option value="datasets/bitcoin-historical-2024.json">bitcoin-historical-2024.json (365 days)</option>
                        <option value="datasets/crypto-top-100.json">crypto-top-100.json (100 currencies)</option>
                        <option value="datasets/stock-market-crashes.json">stock-market-crashes.json (20 crashes)</option>
                    </optgroup>
                    
                    <optgroup label="üöÄ space">
                        <option value="datasets/solar-system-planets.json">solar-system-planets.json (9 planets)</option>
                        <option value="datasets/exoplanets.csv">exoplanets.csv (6000+ planets)</option>
                        <option value="datasets/asteroid-close-approaches-2024.json">asteroid-close-approaches-2024.json (11 asteroids)</option>
                        <option value="datasets/meteorite-landings.json">meteorite-landings.json (1000 impacts)</option>
                        <option value="datasets/iss-location-tracking.json">iss-location-tracking.json</option>
                    </optgroup>
                    
                    <optgroup label="üé≤ misc">
                        <option value="datasets/world-population-countries.json">world-population-countries.json (20 countries)</option>
                        <option value="datasets/wikipedia-trending-2024.json">wikipedia-trending-2024.json (15 articles)</option>
                        <option value="datasets/github-languages-popularity.json">github-languages-popularity.json (15 languages)</option>
                        <option value="datasets/pulsar-vortex.json">pulsar-vortex.json (sonic experiment)</option>
                        <option value="datasets/nebula-cascade.json">nebula-cascade.json (sonic experiment)</option>
                        <option value="datasets/temporal-flux.json">temporal-flux.json (sonic experiment)</option>
                        <option value="datasets/aether-wave.json">aether-wave.json (sonic experiment)</option>
                        <option value="datasets/quantum-drift.json">quantum-drift.json (sonic experiment)</option>
                    </optgroup>
                    
                    <optgroup label="üî¥ live data (requires internet)">
                        <option value="https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson">usgs earthquakes - past hour (real-time)</option>
                        <option value="https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson">usgs earthquakes - past day</option>
                        <option value="https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_month.geojson">usgs earthquakes M4.5+ - past month</option>
                        <option value="https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_month.geojson">usgs earthquakes significant - past month</option>
                    </optgroup>
                </select>
                </div>
                <div class="mt2">
                    <span id="parseStatus" class="f6 gray"></span>
                </div>
            </div>
        </div>
        
        <!-- Patch View (Full Width) -->
        <div id="nodeView" style="margin-bottom: 20px; padding: 20px; width: 100%; overflow-x: hidden;">
            
            <div id="columnHeaders" style="position: relative; height: 48px; margin-bottom: 20px; padding-top: 0px;">
                <div id="leftHeader" style="position: absolute; transform: translateX(-50%);">
                    <div class="b f5 black tc">Data Fields</div>
                    <div class="f5 mt2 tc">
                        <span id="itemCounter" class="black ibm-mono">--/--</span>
                    </div>
                </div>
                <div id="rightHeader" style="position: absolute; transform: translateX(-50%);">
                    <a id="randomizeMappingsBtnHeader" href="#" class="pointer" style="text-decoration: none; opacity: 0.3; pointer-events: none; display: flex; flex-direction: column; align-items: center; padding: 12px 24px; border-radius: 4px; transition: background 0.15s ease, transform 0.05s ease; margin: -12px -24px;">
                        <div class="b f5 black tc mb2">Audio Parameters</div>
                        <div class="f6 tc">
                            <span class="randomize-text gray">click to randomize</span>
                        </div>
                    </a>
                </div>
            </div>
            <svg id="patchViz" style="width: 100%; display: block;"></svg>
            
            <div class="tc mt4">
                <a id="datasetSourceLinkHeader" href="#" target="_blank" class="f7 gray ibm-mono hover-underline" style="display: none; text-decoration: none;"></a>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="tc mt4 pt3 bt b--light-gray">
            <p class="f6 black ibm-mono">
                A project by <a href="https://queral.studio" target="_blank" class="black underline ibm-mono">Luis Queral</a>.
            </p>
        </div>
    </div>
    
    <!-- Main Application Script (ES6 Module) -->
    <script type="module" src="./main.js"></script>
</body>
</html>
